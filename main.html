<html>
<head>
	<link rel="stylesheet" href="style.css" media="screen" type="text/css" />
    <script type='text/javascript'>
        function addFields(){
            // Number of inputs to create
            number = document.getElementById("val").value;
            // Container <div> where dynamic content will be placed
            var container = document.getElementById("container");
            // Clear previous contents of the container
            while (container.hasChildNodes()) {
                container.removeChild(container.lastChild);
            }
            var exp = document.getElementById("expression");
            // Clear previous contents of the container
            while (exp.hasChildNodes()) {
                exp.removeChild(exp.lastChild);
            }
			//Create the HTML table to hold the truth table.
			var table = "<table><tr>";
			//Add the header
			headerString=new Array("a","b","c","d","e","f");
			for(l=0;l<number;l++)
			{
				table+="<th>"+ headerString[l]+"</th>";
			}
			table+="<th>f(x)</th></tr>";
			
            for (var i=0;i<Math.pow(2,number);i++){
				// Append a node with Row indication DEBUG
				//container.appendChild(document.createTextNode("Row " + (i+1)+" "));
				//Break down i into binary representation
				var a=new Array();
				var k=i;
				for(c=0;c<number;c++)
				{
					a[c]=k%2;
					k=(k-k%2)/2;
				}
				//a is in reverse order
				table+="<tr>";
				for (j=number-1;j>=0;j--)
				{
					if(a[j]==0)
					{
						//container.appendChild(document.createTextNode("0"));DEBUG
						table+="<td>0</td>";
					}
					else
					{
						//container.appendChild(document.createTextNode("1"));DEBUG
						table+="<td>1</td>";
					}
				}
				table+="<td><select id=\"row"+i+"\" name=\"val\" value=\"\" style=\"width:\"100%\" class=\"tableTruth\"><option value=\"0\">0</option><option value=\"1\">1</option></select>";
				table+="</tr>";
				//OLD CODE DON'T TOUCH
				// Create an <input> element, set its type and name attributes
				//var input = document.createElement("input");
				//input.size="3";
				//input.type = "text";
				//input.name = "member" + i+","+j;
				//input.id = "row" + i;
				//container.appendChild(input);
				//var input2 = document.createElement("select");
				//var option = document.createElement("option");
				//option.text="0";
				//input2.add(option,input2[0]);
				//var option2 = document.createElement("option");
				//option2.text="1";
				//input2.add(option2,input2[1]);
				//container.appendChild(input2);
				// Append a line break 
				//container.appendChild(document.createElement("br"));
            }
				table+="</table>";
				
				var inputFormula;
				inputFormula = document.getElementById("table");
				inputFormula.innerHTML=table;
				document.getElementById('calculate').style.display = 'inline';
        }
    </script>

    <script type='text/javascript'>
	    function combineTerms(SOP)
    	{
    		var SOPnew = SOP.slice();
    		var changed = 0;
    		for(var i = 0; i<SOPnew.length; i++)
    		{ 
    			var matched = 0;
    			for(var j = 0; j<SOP.length && !matched; j++)
    			{
    				var difference = Math.abs(SOPnew[i] - SOP[j]);
    				for(var k = number; k>=0 && !matched; k--)
    					{
    						if(difference==Math.pow(10,k) && (((Math.max(SOPnew[i],SOP[j]))-difference)%Math.pow(10,k+1)/Math.pow(10,k)<1))
    						{
    							var alreadyPresent = 0;
    							var mergedterm = Math.max(SOPnew[i], SOP[j]) + difference;
								for(var b = 0; b<SOPnew.length; b++)
								{
									if(SOPnew[b] == mergedterm)
									{
										alreadyPresent = 1;
									}
								}
    							if(!alreadyPresent)
    							{
	    							SOPnew[i] = mergedterm;
	    							changed = 1;
	    							matched = 1;
    							}
    						}
    					}
    			}
    		}
    		if(!changed)
    			return SOPnew;
    		return combineTerms(SOPnew);
       	}

	    function removeDuplicates(SOP)
		{
			for(var i = 0; i<SOP.length-1; i++)
			{
				for(var j = i+1; j<SOP.length; j++)
				{
					if(SOP[i] == SOP[j])
					{
						SOP.splice(j,1);
						j-=1;
					}
				}
			}

			return SOP;
		}

		function removeDuplicatesDigital(SOP)
		{
			for(var i = 0; i<SOP.length; i++)
			{
				for(var j = 0; j<SOP.length; j++)
				{
					if(i!=j)
					{
						var c = 0;
						for(var k = 0; k<SOP[i].length && (SOP[i][k]==SOP[j][k] || SOP[i][k] =='2'); k++)
						{
							if(k==SOP[i].length-1)
								c = 1;
						}
						if(c==1)
						{
							if(i>j)
								i--;
							SOP.splice(j,1);
							j--;
						}

					}
				}
			}

			return SOP;
		}

	    function convertArray(SOPi)
	    {
	    	SOP = SOPi.slice()
	    	var digitalSOP = new Array();
	    	for(var i = 0; i<SOP.length; i++)
	    	{
	    		digitalSOP[i] = new Array();
	    		for(var j = number-1; j>=0; j--)
	    		{
	    			if(SOP[i] >= Math.pow(10,j)*2)
	    			{
	    				digitalSOP[i][number-1-j]='2';
	    				SOP[i]-=Math.pow(10,j)*2;

	    			}
	    			else if(SOP[i] >= Math.pow(10,j))
	    				{
	    					digitalSOP[i][number-1-j] = '1';
	    					SOP[i]-=Math.pow(10,j);
	    				}
	    			else
	    			{
	    				digitalSOP[i][number-1-j] = '0';
	    			}
	    		}
	    	}
	    	return digitalSOP;
	    }

    	function calculateSOP()
    	{
    		//Array for Can-SOP
    		var SOP = new Array();
    		//read in each minterm and converts to binary eq
    		for(var i=0;i<Math.pow(2,number);i++)
    		{
				if(document.getElementById("row"+i).value == 1)
				{
					var s = 0;
					var k = i;
					for(var j=number; j>=0;j--)
					{
						if(Math.pow(2,j)<=k)
						{
							s+=Math.pow(10,j);
							k-=Math.pow(2,j);
						}
					}
					
					SOP[SOP.length] = s;
				}
    		}
    		//creates a string for SOP and writes boolean values as variables
    		var printOut = "<br/>"

    		//if no minterms, expression is true
    		if(SOP.length == 0)
    		{
				printOut="0";
				document.getElementById("expression").innerHTML=printOut; 
    			return 0;
    		}
	    		var digitalMinTerms = convertArray(SOP.slice());
	    		alert(digitalMinTerms);
	    		var reducedSOP = removeDuplicates(combineTerms(SOP));
	    		alert(reducedSOP);
	    		var digitalArray = removeDuplicatesDigital(convertArray(reducedSOP));
	    		alert(digitalArray);
	    		//converts boolean values to variables
    		// old 
    		/* for(var i=0;i<reducedSOP.length;i++)
    		{
    			var term =""
    			for(var j=number-1;j>=0;j--)
                {
                	if(reducedSOP[i]>=(Math.pow(10,j)*2))
                	{
                		reducedSOP[i]-=(Math.pow(10,j)*2);
                	}
                	else if(reducedSOP[i]>=Math.pow(10,j))
                	{
                		reducedSOP[i]-=(Math.pow(10,j));
            		term += headerString[number-j-1];
            	}
            	else
            	{
            		term += "!" + headerString[number-j-1];
            	}
	            }
	            printOut+=term;
				printOut+= " + ";
    		}*/

    		for(var i = 0; i<digitalArray.length; i++)
    		{
    			var term = ""
    			for(var j = 0; j<number;j++)
    			{
    				if(digitalArray[i][j] == '1')
    					term+= headerString[j];
    				else if(digitalArray[i][j] =='0')
    					term+= '!' + headerString[j];
    			}
    			printOut+=term;
    			printOut+= ' + ';
    		}
    		printOut=printOut.substring(0,printOut.length-3);
    		document.getElementById("expression").innerHTML=printOut; 
    	}
    </script>
</head>
<body>
<h1 id="header">Un-Truthful</h1>
<h2>Enter the truth table, find the least cost boolean expression</h2>
<div># of Variables:</div>
    <select id="val" name="val" value="">
		<option value="1">1</option>
		<option value="2">2</option>
		<option value="3">3</option>
		<option value="4">4</option>
		<option value="5">5</option>
		<option value="6">6</option>
	</select>
	<br/><br/>
	<input type="button" value="Generate Table" id="filldetails" onclick="addFields()"/>
	<br/>
	<br/>
	<div id="spacing"></div>
    <div id="container"></div>
	<div id="table"></div>
	<br/>
	<div>
		<input type='button' value='Calculate Sum of Products' id ='calculate' onclick='calculateSOP()' style ='display:none'/>
	</div>
	<div id="expression"></div>
</body>
</html>